import bisect
from typing import List


class Solution:
    def longestSubsequence(self, nums: List[int]) -> int:
        n = len(nums)
        memo = {}

        def dfs(i, j, val):
            if i == n:
                return 0
            if (i, j, val) in memo:
                return memo[(i, j, val)]

            res = dfs(i + 1, j, val)
            if j == -1 or nums[i] > nums[j]:
                if val == -1:
                    res = max(res, 1 + dfs(i + 1, i, nums[i]))
                elif val & nums[i]:
                    res = max(res, 1 + dfs(i + 1, i, val & nums[i]))
            memo[(i, j, val)] = res
            return res

        return dfs(0, -1, -1)

    def longestSubsequence2(self, nums: List[int]) -> int:
        res = 0
        for bit in range(32):
            best = [-1]
            for x in nums:
                if x & (1 << bit):
                    index = bisect.bisect_left(best, x)
                    res = max(res, index)
                    if index >= len(best):
                        best.append(x)
                    else:
                        best[index] = x
        return res


s = Solution()
print(s.longestSubsequence(nums=[5, 4, 7]))
print(s.longestSubsequence(nums=[2, 3, 6]))
print(s.longestSubsequence(nums=[0, 1]))
print(s.longestSubsequence(
    nums=[6173, 8253, 4231, 5089, 1925, 1523, 4121, 8660, 4735, 7281, 3615, 4284, 5553, 7364, 3178, 3795, 6543, 1896,
          7825, 2703, 821, 7678, 915, 0, 670, 4833, 2717, 8368, 539, 8241, 1919, 5926, 5565, 7139, 1108, 5874, 3345,
          7454, 6518, 6338, 5791, 1610, 2247, 1134, 6668, 2649, 6655, 2574, 907, 5313, 21, 3191, 3235, 111, 1243, 1419,
          5067, 6679, 7813, 8247, 7808, 7479, 7148, 2026, 694, 6256, 4737, 4507, 7849, 7041, 4597, 6817, 3737, 1192,
          6012, 5123, 2635, 7339, 2645, 7989, 679, 6719, 3790, 216, 5706, 8791, 1367, 1098, 7059, 8114, 8457, 1971,
          2719, 5629]))
print(s.longestSubsequence(
    nums=[4417, 2117, 2762, 2020, 377, 883, 8112, 3198, 403, 1272, 3177, 636, 7628, 8398, 7224, 1851, 3612, 5736, 3165,
          6289, 6816, 7140, 745, 5741, 8192, 3857, 5310, 3164, 6085, 8155, 3307, 830, 3185, 7871, 5453, 8136, 8320,
          1577, 7208, 8756, 347, 5603, 2534, 3214, 6683, 4649, 7960, 3301, 5410, 1322, 6616, 4488, 3694, 4009, 2867,
          3764, 3795, 3227, 5873, 3964, 4571, 6868, 3759, 32, 4120, 1860, 6303, 4645, 1144, 8609, 4730, 4196, 7781,
          4958, 7763, 3252, 6541, 4039, 4531, 5642, 8085, 8152, 7354, 4969, 6118, 1910, 426, 7540, 5733, 2953, 3089,
          5660, 3637, 7950]))
print("---------------------")
print(s.longestSubsequence2(nums=[5, 4, 7]))
print(s.longestSubsequence2(nums=[2, 3, 6]))
print(s.longestSubsequence2(nums=[0, 1]))
print(s.longestSubsequence2(
    nums=[6173, 8253, 4231, 5089, 1925, 1523, 4121, 8660, 4735, 7281, 3615, 4284, 5553, 7364, 3178, 3795, 6543, 1896,
          7825, 2703, 821, 7678, 915, 0, 670, 4833, 2717, 8368, 539, 8241, 1919, 5926, 5565, 7139, 1108, 5874, 3345,
          7454, 6518, 6338, 5791, 1610, 2247, 1134, 6668, 2649, 6655, 2574, 907, 5313, 21, 3191, 3235, 111, 1243, 1419,
          5067, 6679, 7813, 8247, 7808, 7479, 7148, 2026, 694, 6256, 4737, 4507, 7849, 7041, 4597, 6817, 3737, 1192,
          6012, 5123, 2635, 7339, 2645, 7989, 679, 6719, 3790, 216, 5706, 8791, 1367, 1098, 7059, 8114, 8457, 1971,
          2719, 5629]))
print(s.longestSubsequence2(
    nums=[4417, 2117, 2762, 2020, 377, 883, 8112, 3198, 403, 1272, 3177, 636, 7628, 8398, 7224, 1851, 3612, 5736, 3165,
          6289, 6816, 7140, 745, 5741, 8192, 3857, 5310, 3164, 6085, 8155, 3307, 830, 3185, 7871, 5453, 8136, 8320,
          1577, 7208, 8756, 347, 5603, 2534, 3214, 6683, 4649, 7960, 3301, 5410, 1322, 6616, 4488, 3694, 4009, 2867,
          3764, 3795, 3227, 5873, 3964, 4571, 6868, 3759, 32, 4120, 1860, 6303, 4645, 1144, 8609, 4730, 4196, 7781,
          4958, 7763, 3252, 6541, 4039, 4531, 5642, 8085, 8152, 7354, 4969, 6118, 1910, 426, 7540, 5733, 2953, 3089,
          5660, 3637, 7950]))
